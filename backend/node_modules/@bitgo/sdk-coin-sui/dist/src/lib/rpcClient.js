"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.makeRPC = exports.requestIgnoreStatusCode = void 0;
const superagent = __importStar(require("superagent"));
async function request({ url, timeoutMs = undefined, params = {} }) {
    return superagent
        .post(url)
        .send(params)
        .timeout({ deadline: timeoutMs })
        .type('json')
        .set({ Accept: 'application/json' });
}
async function requestIgnoreStatusCode(params) {
    try {
        return await request(params);
    }
    catch (e) {
        if ('response' in e) {
            return e.response;
        }
        throw e;
    }
}
exports.requestIgnoreStatusCode = requestIgnoreStatusCode;
async function makeRPC(url, method, params) {
    const res = await requestIgnoreStatusCode({
        method: 'post',
        url,
        timeoutMs: 3000,
        params: { jsonrpc: '2.0', id: 1, method: method, params: params },
    });
    if (res.body.error) {
        const error = res.body.error;
        throw new Error(`Request to the node failed. Error code: ${error.code}, message: ${error.message}`);
    }
    if (res.statusCode !== 200) {
        throw new Error(`Request to the node failed, Status code: ${res.statusCode}`);
    }
    return res.body.result;
}
exports.makeRPC = makeRPC;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnBjQ2xpZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9ycGNDbGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx1REFBeUM7QUFJekMsS0FBSyxVQUFVLE9BQU8sQ0FBQyxFQUFFLEdBQUcsRUFBRSxTQUFTLEdBQUcsU0FBUyxFQUFFLE1BQU0sR0FBRyxFQUFFLEVBQUU7SUFDaEUsT0FBTyxVQUFVO1NBQ2QsSUFBSSxDQUFDLEdBQUcsQ0FBQztTQUNULElBQUksQ0FBQyxNQUFNLENBQUM7U0FDWixPQUFPLENBQUMsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLENBQUM7U0FDaEMsSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUNaLEdBQUcsQ0FBQyxFQUFFLE1BQU0sRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUM7QUFDekMsQ0FBQztBQUVNLEtBQUssVUFBVSx1QkFBdUIsQ0FBQyxNQUFjO0lBQzFELElBQUk7UUFDRixPQUFPLE1BQU0sT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQzlCO0lBQUMsT0FBTyxDQUFNLEVBQUU7UUFDZixJQUFJLFVBQVUsSUFBSSxDQUFDLEVBQUU7WUFDbkIsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDO1NBQ25CO1FBQ0QsTUFBTSxDQUFDLENBQUM7S0FDVDtBQUNILENBQUM7QUFURCwwREFTQztBQUVNLEtBQUssVUFBVSxPQUFPLENBQUMsR0FBVyxFQUFFLE1BQWMsRUFBRSxNQUFjO0lBQ3ZFLE1BQU0sR0FBRyxHQUFHLE1BQU0sdUJBQXVCLENBQUM7UUFDeEMsTUFBTSxFQUFFLE1BQU07UUFDZCxHQUFHO1FBQ0gsU0FBUyxFQUFFLElBQUk7UUFDZixNQUFNLEVBQUUsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFO0tBQ2xFLENBQUMsQ0FBQztJQUNILElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7UUFDbEIsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDN0IsTUFBTSxJQUFJLEtBQUssQ0FBQywyQ0FBMkMsS0FBSyxDQUFDLElBQUksY0FBYyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztLQUNyRztJQUNELElBQUksR0FBRyxDQUFDLFVBQVUsS0FBSyxHQUFHLEVBQUU7UUFDMUIsTUFBTSxJQUFJLEtBQUssQ0FBQyw0Q0FBNEMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7S0FDL0U7SUFDRCxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0FBQ3pCLENBQUM7QUFmRCwwQkFlQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHN1cGVyYWdlbnQgZnJvbSAnc3VwZXJhZ2VudCc7XG5cbmV4cG9ydCB0eXBlIFBhcmFtcyA9IGFueTtcblxuYXN5bmMgZnVuY3Rpb24gcmVxdWVzdCh7IHVybCwgdGltZW91dE1zID0gdW5kZWZpbmVkLCBwYXJhbXMgPSB7fSB9KSB7XG4gIHJldHVybiBzdXBlcmFnZW50XG4gICAgLnBvc3QodXJsKVxuICAgIC5zZW5kKHBhcmFtcylcbiAgICAudGltZW91dCh7IGRlYWRsaW5lOiB0aW1lb3V0TXMgfSlcbiAgICAudHlwZSgnanNvbicpXG4gICAgLnNldCh7IEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVxdWVzdElnbm9yZVN0YXR1c0NvZGUocGFyYW1zOiBQYXJhbXMpOiBQcm9taXNlPHN1cGVyYWdlbnQuUmVzcG9uc2U+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgcmVxdWVzdChwYXJhbXMpO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBpZiAoJ3Jlc3BvbnNlJyBpbiBlKSB7XG4gICAgICByZXR1cm4gZS5yZXNwb25zZTtcbiAgICB9XG4gICAgdGhyb3cgZTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFrZVJQQyh1cmw6IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhcmFtczogUGFyYW1zKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBhbnk+PiB7XG4gIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RJZ25vcmVTdGF0dXNDb2RlKHtcbiAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICB1cmwsXG4gICAgdGltZW91dE1zOiAzMDAwLFxuICAgIHBhcmFtczogeyBqc29ucnBjOiAnMi4wJywgaWQ6IDEsIG1ldGhvZDogbWV0aG9kLCBwYXJhbXM6IHBhcmFtcyB9LFxuICB9KTtcbiAgaWYgKHJlcy5ib2R5LmVycm9yKSB7XG4gICAgY29uc3QgZXJyb3IgPSByZXMuYm9keS5lcnJvcjtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFJlcXVlc3QgdG8gdGhlIG5vZGUgZmFpbGVkLiBFcnJvciBjb2RlOiAke2Vycm9yLmNvZGV9LCBtZXNzYWdlOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gIH1cbiAgaWYgKHJlcy5zdGF0dXNDb2RlICE9PSAyMDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFJlcXVlc3QgdG8gdGhlIG5vZGUgZmFpbGVkLCBTdGF0dXMgY29kZTogJHtyZXMuc3RhdHVzQ29kZX1gKTtcbiAgfVxuICByZXR1cm4gcmVzLmJvZHkucmVzdWx0O1xufVxuIl19