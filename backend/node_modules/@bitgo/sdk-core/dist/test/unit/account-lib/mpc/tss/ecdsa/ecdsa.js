"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const paillierBigint = __importStar(require("paillier-bigint"));
require("should");
const sinon_1 = __importDefault(require("sinon"));
const sdk_lib_mpc_1 = require("@bitgo/sdk-lib-mpc");
const tss_1 = require("../../../../../../src/account-lib/mpc/tss");
const fixtures_1 = require("./fixtures");
const sdk_opensslbytes_1 = require("@bitgo/sdk-opensslbytes");
const openSSLBytes = (0, sdk_opensslbytes_1.loadWebAssembly)().buffer;
describe('ecdsa tss', function () {
    const ecdsa = new tss_1.Ecdsa();
    let signCombine1, signCombine2;
    before('generate key and sign phase 1 to 4', async function () {
        const paillierKeyStub = sinon_1.default.stub(paillierBigint, 'generateRandomKeys');
        paillierKeyStub.onCall(0).returns(Promise.resolve(fixtures_1.paillierKeyPairs[0]));
        paillierKeyStub.onCall(1).returns(Promise.resolve(fixtures_1.paillierKeyPairs[1]));
        paillierKeyStub.onCall(2).returns(Promise.resolve(fixtures_1.paillierKeyPairs[2]));
        const [keyShare1, keyShare2, keyShare3] = await Promise.all([
            ecdsa.keyShare(1, 2, 3),
            ecdsa.keyShare(2, 2, 3),
            ecdsa.keyShare(3, 2, 3),
        ]);
        const [keyCombined1, keyCombined2, keyCombined3] = [
            ecdsa.keyCombine(keyShare1.pShare, [keyShare2.nShares[1], keyShare3.nShares[1]]),
            ecdsa.keyCombine(keyShare2.pShare, [keyShare1.nShares[2], keyShare3.nShares[2]]),
            ecdsa.keyCombine(keyShare3.pShare, [keyShare1.nShares[3], keyShare2.nShares[3]]),
        ];
        keyCombined1.xShare.y.should.equal(keyCombined2.xShare.y);
        keyCombined1.xShare.y.should.equal(keyCombined3.xShare.y);
        // Collect all VSS from nShares and verify Schnorr proofs against X_i.
        // Note that this is something WP needs to do after keyCombine/keyDerive.
        const Y = (0, sdk_lib_mpc_1.hexToBigInt)(keyCombined1.xShare.y);
        const VSSs = [
            [(0, sdk_lib_mpc_1.hexToBigInt)(keyShare1.nShares[2].v)],
            [(0, sdk_lib_mpc_1.hexToBigInt)(keyShare2.nShares[3].v)],
            [(0, sdk_lib_mpc_1.hexToBigInt)(keyShare3.nShares[1].v)],
        ];
        ecdsa.verifySchnorrProofX(Y, VSSs, 1, keyCombined1.xShare.schnorrProofX).should.be.true();
        ecdsa.verifySchnorrProofX(Y, VSSs, 2, keyCombined2.xShare.schnorrProofX).should.be.true();
        ecdsa.verifySchnorrProofX(Y, VSSs, 3, keyCombined3.xShare.schnorrProofX).should.be.true();
        // Verify Schnorr proofs against X_i for keyDerive and subsequent keyCombine.
        const path = 'm/0/1/2';
        const keyDerive1 = ecdsa.keyDerive(keyShare1.pShare, [keyShare2.nShares[1], keyShare3.nShares[1]], path);
        // Note the VSSs used here are different from the ones used above.
        const derivedY = (0, sdk_lib_mpc_1.hexToBigInt)(keyDerive1.xShare.y);
        const derivedVSSs = [
            [(0, sdk_lib_mpc_1.hexToBigInt)(keyDerive1.nShares[2].v)],
            [(0, sdk_lib_mpc_1.hexToBigInt)(keyShare2.nShares[3].v)],
            [(0, sdk_lib_mpc_1.hexToBigInt)(keyShare3.nShares[1].v)],
        ];
        ecdsa.verifySchnorrProofX(derivedY, derivedVSSs, 1, keyDerive1.xShare.schnorrProofX).should.be.true();
        const keyCombined2FromKeyDerive1 = ecdsa.keyCombine(keyShare2.pShare, [
            keyDerive1.nShares[2],
            keyShare3.nShares[2],
        ]);
        ecdsa
            .verifySchnorrProofX(derivedY, derivedVSSs, 2, keyCombined2FromKeyDerive1.xShare.schnorrProofX)
            .should.be.true();
        const [ntilde1, ntilde2] = await Promise.all([
            sdk_lib_mpc_1.EcdsaRangeProof.generateNtilde(openSSLBytes, 512),
            sdk_lib_mpc_1.EcdsaRangeProof.generateNtilde(openSSLBytes, 512),
        ]);
        const [serializeNtilde1, serializeNtilde2] = [
            sdk_lib_mpc_1.EcdsaTypes.serializeNtildeWithProofs(ntilde1),
            sdk_lib_mpc_1.EcdsaTypes.serializeNtildeWithProofs(ntilde2),
        ];
        const [index1, index2] = [keyCombined1.xShare.i, keyCombined2.xShare.i];
        const [paillierN1to2, paillierN2to1] = [keyCombined1.yShares[index2].n, keyCombined2.yShares[index1].n];
        const [paillierChallenger1to2, paillierChallenger2to1] = await Promise.all([
            sdk_lib_mpc_1.EcdsaPaillierProof.generateP((0, sdk_lib_mpc_1.hexToBigInt)(paillierN1to2)),
            sdk_lib_mpc_1.EcdsaPaillierProof.generateP((0, sdk_lib_mpc_1.hexToBigInt)(paillierN2to1)),
        ]);
        const [xShare1, xShare2] = [
            ecdsa.appendChallenge(keyCombined1.xShare, serializeNtilde1, sdk_lib_mpc_1.EcdsaTypes.serializePaillierChallenge({ p: paillierChallenger1to2 })),
            ecdsa.appendChallenge(keyCombined2.xShare, serializeNtilde2, sdk_lib_mpc_1.EcdsaTypes.serializePaillierChallenge({ p: paillierChallenger2to1 })),
        ];
        const yShare2 = ecdsa.appendChallenge(keyCombined1.yShares[index2], serializeNtilde2, sdk_lib_mpc_1.EcdsaTypes.serializePaillierChallenge({ p: paillierChallenger2to1 }));
        const signShares = await ecdsa.signShare(xShare1, yShare2);
        const signConvertS21 = await ecdsa.signConvertStep1({
            xShare: xShare2,
            yShare: keyCombined2.yShares[index1],
            kShare: signShares.kShare,
        });
        const signConvertS12 = await ecdsa.signConvertStep2({
            aShare: signConvertS21.aShare,
            wShare: signShares.wShare,
        });
        const signConvertS21_2 = await ecdsa.signConvertStep3({
            muShare: signConvertS12.muShare,
            bShare: signConvertS21.bShare,
        });
        [signCombine1, signCombine2] = [
            ecdsa.signCombine({
                gShare: signConvertS12.gShare,
                signIndex: {
                    i: signConvertS12.muShare.i,
                    j: signConvertS12.muShare.j,
                },
            }),
            ecdsa.signCombine({
                gShare: signConvertS21_2.gShare,
                signIndex: {
                    i: signConvertS21_2.signIndex.i,
                    j: signConvertS21_2.signIndex.j,
                },
            }),
        ];
    });
    it('sign phase 5 should succeed', async function () {
        // TODO(HSM-129): There is a bug signing unhashed message (although this deviates from DSA spec) if the message is a little long.
        //       Some discrepancy between Ecdsa.sign and secp256k1.recoverPublicKey on handling the message input.
        const message = Buffer.from('GG18 PHASE 5');
        // Starting phase 5
        // In addition to returning s_i, Ecdsa.sign() now also calculates data needed for steps 5A and 5B:
        //   - sample random l_i and rho_i (5A)
        //   - computes V_i and A_i (5B)]
        //   - computes commitment and decommitment of (V_i, A_i) (5A, 5B)
        //   - generates proofs of knowledge of s_i, l_i, rho_i w.r.t. V_i, A_i (5B)
        const [sign1, sign2] = [
            ecdsa.generateVAProofs(message, ecdsa.sign(message, signCombine1.oShare, signCombine2.dShare)),
            ecdsa.generateVAProofs(message, ecdsa.sign(message, signCombine2.oShare, signCombine1.dShare)),
        ];
        sign1.R.should.equal(sign2.R);
        sign1.y.should.equal(sign2.y);
        sign1.m.toString('hex').should.equal(sign2.m.toString('hex'));
        // Step 5A: Calculations done by Ecdsa.sign() above, and broadcast commitment of (V_i, A_i) to other parties.
        //          The following values will be sent via communication channel at the end of 5A.
        // const commitmentVA1 = sign1.comDecomVA.commitment;
        // const commitmentVA2 = sign2.comDecomVA.commitment;
        // Step 5B: After having received all commitments of (V_i, A_i) from other parties,
        //          each party will broadcast decommitment of (V_i, A_i) and ZK proofs returned by Ecdsa.sign() above
        //          to other parties.  Then Ecdsa.verifyVAShares() below will:
        //   - verify commitments of (V_i, A_i) received from other parties (5B)
        //   - verify ZK proofs of (V_i, A_i) received from other parties (5B)
        //   - calculate V out of G, y, r, m, and all V_i, calculate A as sum of all A_i (5B)
        //   - calculate U_i and T_i and commitment and decommitment of (U_i, T_i) (5C)
        const [publicVAShares_1, publicVAShares_2] = [sign1, sign2];
        const [UT1, UT2] = [
            ecdsa.verifyVAShares(sign1, [publicVAShares_2]),
            ecdsa.verifyVAShares(sign2, [publicVAShares_1]),
        ];
        // Step 5C: Calculations of U_i, T_i done by Ecdsa.verifyVAShares above,
        //          and broadcast commitment of (U_i, T_i) to other parties.
        //          The following values will be sent via communication channel at the end of 5C.
        // const commitmentUT1 = UT1.comDecomUT.commitment;
        // const commitmentUT2 = UT2.comDecomUT.commitment;
        // Step 5D: After having received all commitments of (U_i, T_i) from other parties,
        //          each party will broadcast decommitment of (U_i, T_i) returned by Ecdsa.verifyVAShares() above
        //          to other parties.  Then Ecdsa.verifyUTShares() below will:
        //  - verify commitments of (U_i, T_i) received from other parties (5D)
        //  - calculate U as sum of all U_i, calculate T as sum of all T_i (5D)
        //  - if U equals T, then return own SShare which is being returned by Ecdsa.sign() right now (5E)
        const [publicUTShares_1, publicUTShares_2] = [UT1, UT2];
        const [signature1, signature2] = [
            ecdsa.verifyUTShares(UT1, [publicUTShares_2]),
            ecdsa.verifyUTShares(UT2, [publicUTShares_1]),
        ];
        // Step 5E: Broadcast s_i returned by Ecdsa.verifyUTShares() above to other parties.
        //          Verify the sum of s_i should be a valid signature.
        const signature = ecdsa.constructSignature([signature1, signature2]);
        ecdsa.verify(message, signature).should.be.true();
    });
    it('sign phase 5 fail - malicious player cheats with bad s share', async function () {
        const message = Buffer.from('GG18 PHASE 5');
        const [sign1, sign2] = [
            ecdsa.generateVAProofs(message, ecdsa.sign(message, signCombine1.oShare, signCombine2.dShare)),
            ecdsa.generateVAProofs(message, ecdsa.sign(message, signCombine2.oShare, signCombine1.dShare)),
        ];
        sign1.R.should.equal(sign2.R);
        sign1.y.should.equal(sign2.y);
        sign1.m.toString('hex').should.equal(sign2.m.toString('hex'));
        // Change the s share of sign1, and recalcualte its V along with the commitment/proof by following protocol.
        const bad_s = (0, sdk_lib_mpc_1.hexToBigInt)(sign1.s) + BigInt(1);
        const bad_V = tss_1.Ecdsa.curve.pointAdd(tss_1.Ecdsa.curve.pointMultiply((0, sdk_lib_mpc_1.hexToBigInt)(sign1.R), bad_s), tss_1.Ecdsa.curve.basePointMult(sign1.l));
        const comDecom_V_A = sdk_lib_mpc_1.HashCommitment.createCommitment(Buffer.concat([
            (0, sdk_lib_mpc_1.bigIntToBufferBE)(bad_V, tss_1.Ecdsa.curve.pointBytes),
            (0, sdk_lib_mpc_1.bigIntToBufferBE)(sign1.A, tss_1.Ecdsa.curve.pointBytes),
        ]));
        const zkVProof = sdk_lib_mpc_1.EcdsaZkVProof.createZkVProof(bad_V, bad_s, sign1.l, (0, sdk_lib_mpc_1.hexToBigInt)(sign1.R), tss_1.Ecdsa.curve, sign1.proofContext);
        sign1.s = (0, sdk_lib_mpc_1.bigIntToBufferBE)(bad_s, 32).toString('hex');
        sign1.V = bad_V;
        sign1.comDecomVA = comDecom_V_A;
        sign1.zkVProofV = zkVProof;
        // 5B will pass.
        const [publicVAShares_1, publicVAShares_2] = [sign1, sign2];
        const [UT1, UT2] = [
            ecdsa.verifyVAShares(sign1, [publicVAShares_2]),
            ecdsa.verifyVAShares(sign2, [publicVAShares_1]),
        ];
        // But verification at beginning of 5E will fail.
        const [publicUTShares_1, publicUTShares_2] = [UT1, UT2];
        (() => ecdsa.verifyUTShares(UT1, [publicUTShares_2])).should.throw('Sum of all U_i does not match sum of all T_i');
        (() => ecdsa.verifyUTShares(UT2, [publicUTShares_1])).should.throw('Sum of all U_i does not match sum of all T_i');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWNkc2EuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi90ZXN0L3VuaXQvYWNjb3VudC1saWIvbXBjL3Rzcy9lY2RzYS9lY2RzYS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsZ0VBQWtEO0FBQ2xELGtCQUFnQjtBQUNoQixrREFBMEI7QUFDMUIsb0RBUTRCO0FBQzVCLG1FQUFrRTtBQU1sRSx5Q0FBOEM7QUFDOUMsOERBQTBEO0FBRTFELE1BQU0sWUFBWSxHQUFHLElBQUEsa0NBQWUsR0FBRSxDQUFDLE1BQU0sQ0FBQztBQUU5QyxRQUFRLENBQUMsV0FBVyxFQUFFO0lBQ3BCLE1BQU0sS0FBSyxHQUFHLElBQUksV0FBSyxFQUFFLENBQUM7SUFFMUIsSUFBSSxZQUEyQixFQUFFLFlBQTJCLENBQUM7SUFFN0QsTUFBTSxDQUFDLG9DQUFvQyxFQUFFLEtBQUs7UUFDaEQsTUFBTSxlQUFlLEdBQUcsZUFBSyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztRQUV6RSxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDJCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RSxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDJCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RSxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDJCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV4RSxNQUFNLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUMsR0FBRyxNQUFN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Q0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1NBQ2hELENBQUM7UUFFRixpREFBaUQ7UUFDakQsTUFBTSxDQUFDLGdCQUFnQixFQUFFLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxHQUFvQixFQUFFLEdBQW9CLENBQUMsQ0FBQztRQUMxRixDQUFDLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsR0FBRyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO1FBQ25ILENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLDhDQUE4QyxDQUFDLENBQUM7SUFDckgsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBhaWxsaWVyQmlnaW50IGZyb20gJ3BhaWxsaWVyLWJpZ2ludCc7XG5pbXBvcnQgJ3Nob3VsZCc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IHtcbiAgRWNkc2FQYWlsbGllclByb29mLFxuICBFY2RzYVJhbmdlUHJvb2YsXG4gIEVjZHNhVHlwZXMsXG4gIEVjZHNhWmtWUHJvb2YsXG4gIEhhc2hDb21taXRtZW50LFxuICBoZXhUb0JpZ0ludCxcbiAgYmlnSW50VG9CdWZmZXJCRSxcbn0gZnJvbSAnQGJpdGdvL3Nkay1saWItbXBjJztcbmltcG9ydCB7IEVjZHNhIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2FjY291bnQtbGliL21wYy90c3MnO1xuaW1wb3J0IHtcbiAgUHVibGljVVRTaGFyZSxcbiAgUHVibGljVkFTaGFyZVdpdGhQcm9vZnMsXG4gIFNpZ25Db21iaW5lUlQsXG59IGZyb20gJy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9hY2NvdW50LWxpYi9tcGMvdHNzL2VjZHNhL3R5cGVzJztcbmltcG9ydCB7IHBhaWxsaWVyS2V5UGFpcnMgfSBmcm9tICcuL2ZpeHR1cmVzJztcbmltcG9ydCB7IGxvYWRXZWJBc3NlbWJseSB9IGZyb20gJ0BiaXRnby9zZGstb3BlbnNzbGJ5dGVzJztcblxuY29uc3Qgb3BlblNTTEJ5dGVzID0gbG9hZFdlYkFzc2VtYmx5KCkuYnVmZmVyO1xuXG5kZXNjcmliZSgnZWNkc2EgdHNzJywgZnVuY3Rpb24gKCkge1xuICBjb25zdCBlY2RzYSA9IG5ldyBFY2RzYSgpO1xuXG4gIGxldCBzaWduQ29tYmluZTE6IFNpZ25Db21iaW5lUlQsIHNpZ25Db21iaW5lMjogU2lnbkNvbWJpbmVSVDtcblxuICBiZWZvcmUoJ2dlbmVyYXRlIGtleSBhbmQgc2lnbiBwaGFzZSAxIHRvIDQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgcGFpbGxpZXJLZXlTdHViID0gc2lub24uc3R1YihwYWlsbGllckJpZ2ludCwgJ2dlbmVyYXRlUmFuZG9tS2V5cycpO1xuXG4gICAgcGFpbGxpZXJLZXlTdHViLm9uQ2FsbCgwKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShwYWlsbGllcktleVBhaXJzWzBdKSk7XG4gICAgcGFpbGxpZXJLZXlTdHViLm9uQ2FsbCgxKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShwYWlsbGllcktleVBhaXJzWzFdKSk7XG4gICAgcGFpbGxpZXJLZXlTdHViLm9uQ2FsbCgyKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShwYWlsbGllcktleVBhaXJzWzJdKSk7XG5cbiAgICBjb25zdCBba2V5U2hhcmUxLCBrZXlTaGFyZTIsIGtleVNoYXJlM10gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBlY2RzYS5rZXlTaGFyZSgxLCAyLCAzKSxcbiAgICAgIGVjZHNhLmtleVNoYXJlKDIsIDIsIDMpLFxuICAgICAgZWNkc2Eua2V5U2hhcmUoMywgMiwgMyksXG4gICAgXSk7XG5cbiAgICBjb25zdCBba2V5Q29tYmluZWQxLCBrZXlDb21iaW5lZDIsIGtleUNvbWJpbmVkM10gPSBbXG4gICAgICBlY2RzYS5rZXlDb21iaW5lKGtleVNoYXJlMS5wU2hhcmUsIFtrZXlTaGFyZTIublNoYXJlc1sxXSwga2V5U2hhcmUzLm5TaGFyZXNbMV1dKSxcbiAgICAgIGVjZHNhLmtleUNvbWJpbmUoa2V5U2hhcmUyLnBTaGFyZSwgW2tleVNoYXJlMS5uU2hhcmVzWzJdLCBrZXlTaGFyZTMublNoYXJlc1syXV0pLFxuICAgICAgZWNkc2Eua2V5Q29tYmluZShrZXlTaGFyZTMucFNoYXJlLCBba2V5U2hhcmUxLm5TaGFyZXNbM10sIGtleVNoYXJlMi5uU2hhcmVzWzNdXSksXG4gICAgXTtcblxuICAgIGtleUNvbWJpbmVkMS54U2hhcmUueS5zaG91bGQuZXF1YWwoa2V5Q29tYmluZWQyLnhTaGFyZS55KTtcbiAgICBrZXlDb21iaW5lZDEueFNoYXJlLnkuc2hvdWxkLmVxdWFsKGtleUNvbWJpbmVkMy54U2hhcmUueSk7XG5cbiAgICAvLyBDb2xsZWN0IGFsbCBWU1MgZnJvbSBuU2hhcmVzIGFuZCB2ZXJpZnkgU2Nobm9yciBwcm9vZnMgYWdhaW5zdCBYX2kuXG4gICAgLy8gTm90ZSB0aGF0IHRoaXMgaXMgc29tZXRoaW5nIFdQIG5lZWRzIHRvIGRvIGFmdGVyIGtleUNvbWJpbmUva2V5RGVyaXZlLlxuICAgIGNvbnN0IFkgPSBoZXhUb0JpZ0ludChrZXlDb21iaW5lZDEueFNoYXJlLnkpO1xuXG4gICAgY29uc3QgVlNTcyA9IFtcbiAgICAgIFtoZXhUb0JpZ0ludChrZXlTaGFyZTEublNoYXJlc1syXS52ISldLFxuICAgICAgW2hleFRvQmlnSW50KGtleVNoYXJlMi5uU2hhcmVzWzNdLnYhKV0sXG4gICAgICBbaGV4VG9CaWdJbnQoa2V5U2hhcmUzLm5TaGFyZXNbMV0udiEpXSxcbiAgICBdO1xuXG4gICAgZWNkc2EudmVyaWZ5U2Nobm9yclByb29mWChZLCBWU1NzLCAxLCBrZXlDb21iaW5lZDEueFNoYXJlLnNjaG5vcnJQcm9vZlgpLnNob3VsZC5iZS50cnVlKCk7XG4gICAgZWNkc2EudmVyaWZ5U2Nobm9yclByb29mWChZLCBWU1NzLCAyLCBrZXlDb21iaW5lZDIueFNoYXJlLnNjaG5vcnJQcm9vZlgpLnNob3VsZC5iZS50cnVlKCk7XG4gICAgZWNkc2EudmVyaWZ5U2Nobm9yclByb29mWChZLCBWU1NzLCAzLCBrZXlDb21iaW5lZDMueFNoYXJlLnNjaG5vcnJQcm9vZlgpLnNob3VsZC5iZS50cnVlKCk7XG5cbiAgICAvLyBWZXJpZnkgU2Nobm9yciBwcm9vZnMgYWdhaW5zdCBYX2kgZm9yIGtleURlcml2ZSBhbmQgc3Vic2VxdWVudCBrZXlDb21iaW5lLlxuICAgIGNvbnN0IHBhdGggPSAnbS8wLzEvMic7XG4gICAgY29uc3Qga2V5RGVyaXZlMSA9IGVjZHNhLmtleURlcml2ZShrZXlTaGFyZTEucFNoYXJlLCBba2V5U2hhcmUyLm5TaGFyZXNbMV0sIGtleVNoYXJlMy5uU2hhcmVzWzFdXSwgcGF0aCk7XG5cbiAgICAvLyBOb3RlIHRoZSBWU1NzIHVzZWQgaGVyZSBhcmUgZGlmZmVyZW50IGZyb20gdGhlIG9uZXMgdXNlZCBhYm92ZS5cbiAgICBjb25zdCBkZXJpdmVkWSA9IGhleFRvQmlnSW50KGtleURlcml2ZTEueFNoYXJlLnkpO1xuICAgIGNvbnN0IGRlcml2ZWRWU1NzID0gW1xuICAgICAgW2hleFRvQmlnSW50KGtleURlcml2ZTEublNoYXJlc1syXS52ISldLFxuICAgICAgW2hleFRvQmlnSW50KGtleVNoYXJlMi5uU2hhcmVzWzNdLnYhKV0sXG4gICAgICBbaGV4VG9CaWdJbnQoa2V5U2hhcmUzLm5TaGFyZXNbMV0udiEpXSxcbiAgICBdO1xuICAgIGVjZHNhLnZlcmlmeVNjaG5vcnJQcm9vZlgoZGVyaXZlZFksIGRlcml2ZWRWU1NzLCAxLCBrZXlEZXJpdmUxLnhTaGFyZS5zY2hub3JyUHJvb2ZYKS5zaG91bGQuYmUudHJ1ZSgpO1xuXG4gICAgY29uc3Qga2V5Q29tYmluZWQyRnJvbUtleURlcml2ZTEgPSBlY2RzYS5rZXlDb21iaW5lKGtleVNoYXJlMi5wU2hhcmUsIFtcbiAgICAgIGtleURlcml2ZTEublNoYXJlc1syXSxcbiAgICAgIGtleVNoYXJlMy5uU2hhcmVzWzJdLFxuICAgIF0pO1xuICAgIGVjZHNhXG4gICAgICAudmVyaWZ5U2Nobm9yclByb29mWChkZXJpdmVkWSwgZGVyaXZlZFZTU3MsIDIsIGtleUNvbWJpbmVkMkZyb21LZXlEZXJpdmUxLnhTaGFyZS5zY2hub3JyUHJvb2ZYKVxuICAgICAgLnNob3VsZC5iZS50cnVlKCk7XG5cbiAgICBjb25zdCBbbnRpbGRlMSwgbnRpbGRlMl0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBFY2RzYVJhbmdlUHJvb2YuZ2VuZXJhdGVOdGlsZGUob3BlblNTTEJ5dGVzLCA1MTIpLFxuICAgICAgRWNkc2FSYW5nZVByb29mLmdlbmVyYXRlTnRpbGRlKG9wZW5TU0xCeXRlcywgNTEyKSxcbiAgICBdKTtcblxuICAgIGNvbnN0IFtzZXJpYWxpemVOdGlsZGUxLCBzZXJpYWxpemVOdGlsZGUyXSA9IFtcbiAgICAgIEVjZHNhVHlwZXMuc2VyaWFsaXplTnRpbGRlV2l0aFByb29mcyhudGlsZGUxKSxcbiAgICAgIEVjZHNhVHlwZXMuc2VyaWFsaXplTnRpbGRlV2l0aFByb29mcyhudGlsZGUyKSxcbiAgICBdO1xuXG4gICAgY29uc3QgW2luZGV4MSwgaW5kZXgyXSA9IFtrZXlDb21iaW5lZDEueFNoYXJlLmksIGtleUNvbWJpbmVkMi54U2hhcmUuaV07XG5cbiAgICBjb25zdCBbcGFpbGxpZXJOMXRvMiwgcGFpbGxpZXJOMnRvMV0gPSBba2V5Q29tYmluZWQxLnlTaGFyZXNbaW5kZXgyXS5uLCBrZXlDb21iaW5lZDIueVNoYXJlc1tpbmRleDFdLm5dO1xuXG4gICAgY29uc3QgW3BhaWxsaWVyQ2hhbGxlbmdlcjF0bzIsIHBhaWxsaWVyQ2hhbGxlbmdlcjJ0bzFdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgRWNkc2FQYWlsbGllclByb29mLmdlbmVyYXRlUChoZXhUb0JpZ0ludChwYWlsbGllck4xdG8yKSksXG4gICAgICBFY2RzYVBhaWxsaWVyUHJvb2YuZ2VuZXJhdGVQKGhleFRvQmlnSW50KHBhaWxsaWVyTjJ0bzEpKSxcbiAgICBdKTtcblxuICAgIGNvbnN0IFt4U2hhcmUxLCB4U2hhcmUyXSA9IFtcbiAgICAgIGVjZHNhLmFwcGVuZENoYWxsZW5nZShcbiAgICAgICAga2V5Q29tYmluZWQxLnhTaGFyZSxcbiAgICAgICAgc2VyaWFsaXplTnRpbGRlMSxcbiAgICAgICAgRWNkc2FUeXBlcy5zZXJpYWxpemVQYWlsbGllckNoYWxsZW5nZSh7IHA6IHBhaWxsaWVyQ2hhbGxlbmdlcjF0bzIgfSlcbiAgICAgICksXG4gICAgICBlY2RzYS5hcHBlbmRDaGFsbGVuZ2UoXG4gICAgICAgIGtleUNvbWJpbmVkMi54U2hhcmUsXG4gICAgICAgIHNlcmlhbGl6ZU50aWxkZTIsXG4gICAgICAgIEVjZHNhVHlwZXMuc2VyaWFsaXplUGFpbGxpZXJDaGFsbGVuZ2UoeyBwOiBwYWlsbGllckNoYWxsZW5nZXIydG8xIH0pXG4gICAgICApLFxuICAgIF07XG5cbiAgICBjb25zdCB5U2hhcmUyID0gZWNkc2EuYXBwZW5kQ2hhbGxlbmdlKFxuICAgICAga2V5Q29tYmluZWQxLnlTaGFyZXNbaW5kZXgyXSxcbiAgICAgIHNlcmlhbGl6ZU50aWxkZTIsXG4gICAgICBFY2RzYVR5cGVzLnNlcmlhbGl6ZVBhaWxsaWVyQ2hhbGxlbmdlKHsgcDogcGFpbGxpZXJDaGFsbGVuZ2VyMnRvMSB9KVxuICAgICk7XG5cbiAgICBjb25zdCBzaWduU2hhcmVzID0gYXdhaXQgZWNkc2Euc2lnblNoYXJlKHhTaGFyZTEsIHlTaGFyZTIpO1xuXG4gICAgY29uc3Qgc2lnbkNvbnZlcnRTMjEgPSBhd2FpdCBlY2RzYS5zaWduQ29udmVydFN0ZXAxKHtcbiAgICAgIHhTaGFyZTogeFNoYXJlMixcbiAgICAgIHlTaGFyZToga2V5Q29tYmluZWQyLnlTaGFyZXNbaW5kZXgxXSxcbiAgICAgIGtTaGFyZTogc2lnblNoYXJlcy5rU2hhcmUsXG4gICAgfSk7XG4gICAgY29uc3Qgc2lnbkNvbnZlcnRTMTIgPSBhd2FpdCBlY2RzYS5zaWduQ29udmVydFN0ZXAyKHtcbiAgICAgIGFTaGFyZTogc2lnbkNvbnZlcnRTMjEuYVNoYXJlLFxuICAgICAgd1NoYXJlOiBzaWduU2hhcmVzLndTaGFyZSxcbiAgICB9KTtcbiAgICBjb25zdCBzaWduQ29udmVydFMyMV8yID0gYXdhaXQgZWNkc2Euc2lnbkNvbnZlcnRTdGVwMyh7XG4gICAgICBtdVNoYXJlOiBzaWduQ29udmVydFMxMi5tdVNoYXJlLFxuICAgICAgYlNoYXJlOiBzaWduQ29udmVydFMyMS5iU2hhcmUsXG4gICAgfSk7XG5cbiAgICBbc2lnbkNvbWJpbmUxLCBzaWduQ29tYmluZTJdID0gW1xuICAgICAgZWNkc2Euc2lnbkNvbWJpbmUoe1xuICAgICAgICBnU2hhcmU6IHNpZ25Db252ZXJ0UzEyLmdTaGFyZSxcbiAgICAgICAgc2lnbkluZGV4OiB7XG4gICAgICAgICAgaTogc2lnbkNvbnZlcnRTMTIubXVTaGFyZS5pLFxuICAgICAgICAgIGo6IHNpZ25Db252ZXJ0UzEyLm11U2hhcmUuaixcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgZWNkc2Euc2lnbkNvbWJpbmUoe1xuICAgICAgICBnU2hhcmU6IHNpZ25Db252ZXJ0UzIxXzIuZ1NoYXJlLFxuICAgICAgICBzaWduSW5kZXg6IHtcbiAgICAgICAgICBpOiBzaWduQ29udmVydFMyMV8yLnNpZ25JbmRleC5pLFxuICAgICAgICAgIGo6IHNpZ25Db252ZXJ0UzIxXzIuc2lnbkluZGV4LmosXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICBdO1xuICB9KTtcblxuICBpdCgnc2lnbiBwaGFzZSA1IHNob3VsZCBzdWNjZWVkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIC8vIFRPRE8oSFNNLTEyOSk6IFRoZXJlIGlzIGEgYnVnIHNpZ25pbmcgdW5oYXNoZWQgbWVzc2FnZSAoYWx0aG91Z2ggdGhpcyBkZXZpYXRlcyBmcm9tIERTQSBzcGVjKSBpZiB0aGUgbWVzc2FnZSBpcyBhIGxpdHRsZSBsb25nLlxuICAgIC8vICAgICAgIFNvbWUgZGlzY3JlcGFuY3kgYmV0d2VlbiBFY2RzYS5zaWduIGFuZCBzZWNwMjU2azEucmVjb3ZlclB1YmxpY0tleSBvbiBoYW5kbGluZyB0aGUgbWVzc2FnZSBpbnB1dC5cbiAgICBjb25zdCBtZXNzYWdlID0gQnVmZmVyLmZyb20oJ0dHMTggUEhBU0UgNScpO1xuXG4gICAgLy8gU3RhcnRpbmcgcGhhc2UgNVxuICAgIC8vIEluIGFkZGl0aW9uIHRvIHJldHVybmluZyBzX2ksIEVjZHNhLnNpZ24oKSBub3cgYWxzbyBjYWxjdWxhdGVzIGRhdGEgbmVlZGVkIGZvciBzdGVwcyA1QSBhbmQgNUI6XG4gICAgLy8gICAtIHNhbXBsZSByYW5kb20gbF9pIGFuZCByaG9faSAoNUEpXG4gICAgLy8gICAtIGNvbXB1dGVzIFZfaSBhbmQgQV9pICg1QildXG4gICAgLy8gICAtIGNvbXB1dGVzIGNvbW1pdG1lbnQgYW5kIGRlY29tbWl0bWVudCBvZiAoVl9pLCBBX2kpICg1QSwgNUIpXG4gICAgLy8gICAtIGdlbmVyYXRlcyBwcm9vZnMgb2Yga25vd2xlZGdlIG9mIHNfaSwgbF9pLCByaG9faSB3LnIudC4gVl9pLCBBX2kgKDVCKVxuICAgIGNvbnN0IFtzaWduMSwgc2lnbjJdID0gW1xuICAgICAgZWNkc2EuZ2VuZXJhdGVWQVByb29mcyhtZXNzYWdlLCBlY2RzYS5zaWduKG1lc3NhZ2UsIHNpZ25Db21iaW5lMS5vU2hhcmUsIHNpZ25Db21iaW5lMi5kU2hhcmUpKSxcbiAgICAgIGVjZHNhLmdlbmVyYXRlVkFQcm9vZnMobWVzc2FnZSwgZWNkc2Euc2lnbihtZXNzYWdlLCBzaWduQ29tYmluZTIub1NoYXJlLCBzaWduQ29tYmluZTEuZFNoYXJlKSksXG4gICAgXTtcblxuICAgIHNpZ24xLlIuc2hvdWxkLmVxdWFsKHNpZ24yLlIpO1xuICAgIHNpZ24xLnkuc2hvdWxkLmVxdWFsKHNpZ24yLnkpO1xuICAgIHNpZ24xLm0udG9TdHJpbmcoJ2hleCcpLnNob3VsZC5lcXVhbChzaWduMi5tLnRvU3RyaW5nKCdoZXgnKSk7XG5cbiAgICAvLyBTdGVwIDVBOiBDYWxjdWxhdGlvbnMgZG9uZSBieSBFY2RzYS5zaWduKCkgYWJvdmUsIGFuZCBicm9hZGNhc3QgY29tbWl0bWVudCBvZiAoVl9pLCBBX2kpIHRvIG90aGVyIHBhcnRpZXMuXG4gICAgLy8gICAgICAgICAgVGhlIGZvbGxvd2luZyB2YWx1ZXMgd2lsbCBiZSBzZW50IHZpYSBjb21tdW5pY2F0aW9uIGNoYW5uZWwgYXQgdGhlIGVuZCBvZiA1QS5cbiAgICAvLyBjb25zdCBjb21taXRtZW50VkExID0gc2lnbjEuY29tRGVjb21WQS5jb21taXRtZW50O1xuICAgIC8vIGNvbnN0IGNvbW1pdG1lbnRWQTIgPSBzaWduMi5jb21EZWNvbVZBLmNvbW1pdG1lbnQ7XG5cbiAgICAvLyBTdGVwIDVCOiBBZnRlciBoYXZpbmcgcmVjZWl2ZWQgYWxsIGNvbW1pdG1lbnRzIG9mIChWX2ksIEFfaSkgZnJvbSBvdGhlciBwYXJ0aWVzLFxuICAgIC8vICAgICAgICAgIGVhY2ggcGFydHkgd2lsbCBicm9hZGNhc3QgZGVjb21taXRtZW50IG9mIChWX2ksIEFfaSkgYW5kIFpLIHByb29mcyByZXR1cm5lZCBieSBFY2RzYS5zaWduKCkgYWJvdmVcbiAgICAvLyAgICAgICAgICB0byBvdGhlciBwYXJ0aWVzLiAgVGhlbiBFY2RzYS52ZXJpZnlWQVNoYXJlcygpIGJlbG93IHdpbGw6XG4gICAgLy8gICAtIHZlcmlmeSBjb21taXRtZW50cyBvZiAoVl9pLCBBX2kpIHJlY2VpdmVkIGZyb20gb3RoZXIgcGFydGllcyAoNUIpXG4gICAgLy8gICAtIHZlcmlmeSBaSyBwcm9vZnMgb2YgKFZfaSwgQV9pKSByZWNlaXZlZCBmcm9tIG90aGVyIHBhcnRpZXMgKDVCKVxuICAgIC8vICAgLSBjYWxjdWxhdGUgViBvdXQgb2YgRywgeSwgciwgbSwgYW5kIGFsbCBWX2ksIGNhbGN1bGF0ZSBBIGFzIHN1bSBvZiBhbGwgQV9pICg1QilcbiAgICAvLyAgIC0gY2FsY3VsYXRlIFVfaSBhbmQgVF9pIGFuZCBjb21taXRtZW50IGFuZCBkZWNvbW1pdG1lbnQgb2YgKFVfaSwgVF9pKSAoNUMpXG4gICAgY29uc3QgW3B1YmxpY1ZBU2hhcmVzXzEsIHB1YmxpY1ZBU2hhcmVzXzJdID0gW3NpZ24xIGFzIFB1YmxpY1ZBU2hhcmVXaXRoUHJvb2ZzLCBzaWduMiBhcyBQdWJsaWNWQVNoYXJlV2l0aFByb29mc107XG4gICAgY29uc3QgW1VUMSwgVVQyXSA9IFtcbiAgICAgIGVjZHNhLnZlcmlmeVZBU2hhcmVzKHNpZ24xLCBbcHVibGljVkFTaGFyZXNfMl0pLFxuICAgICAgZWNkc2EudmVyaWZ5VkFTaGFyZXMoc2lnbjIsIFtwdWJsaWNWQVNoYXJlc18xXSksXG4gICAgXTtcblxuICAgIC8vIFN0ZXAgNUM6IENhbGN1bGF0aW9ucyBvZiBVX2ksIFRfaSBkb25lIGJ5IEVjZHNhLnZlcmlmeVZBU2hhcmVzIGFib3ZlLFxuICAgIC8vICAgICAgICAgIGFuZCBicm9hZGNhc3QgY29tbWl0bWVudCBvZiAoVV9pLCBUX2kpIHRvIG90aGVyIHBhcnRpZXMuXG4gICAgLy8gICAgICAgICAgVGhlIGZvbGxvd2luZyB2YWx1ZXMgd2lsbCBiZSBzZW50IHZpYSBjb21tdW5pY2F0aW9uIGNoYW5uZWwgYXQgdGhlIGVuZCBvZiA1Qy5cbiAgICAvLyBjb25zdCBjb21taXRtZW50VVQxID0gVVQxLmNvbURlY29tVVQuY29tbWl0bWVudDtcbiAgICAvLyBjb25zdCBjb21taXRtZW50VVQyID0gVVQyLmNvbURlY29tVVQuY29tbWl0bWVudDtcblxuICAgIC8vIFN0ZXAgNUQ6IEFmdGVyIGhhdmluZyByZWNlaXZlZCBhbGwgY29tbWl0bWVudHMgb2YgKFVfaSwgVF9pKSBmcm9tIG90aGVyIHBhcnRpZXMsXG4gICAgLy8gICAgICAgICAgZWFjaCBwYXJ0eSB3aWxsIGJyb2FkY2FzdCBkZWNvbW1pdG1lbnQgb2YgKFVfaSwgVF9pKSByZXR1cm5lZCBieSBFY2RzYS52ZXJpZnlWQVNoYXJlcygpIGFib3ZlXG4gICAgLy8gICAgICAgICAgdG8gb3RoZXIgcGFydGllcy4gIFRoZW4gRWNkc2EudmVyaWZ5VVRTaGFyZXMoKSBiZWxvdyB3aWxsOlxuICAgIC8vICAtIHZlcmlmeSBjb21taXRtZW50cyBvZiAoVV9pLCBUX2kpIHJlY2VpdmVkIGZyb20gb3RoZXIgcGFydGllcyAoNUQpXG4gICAgLy8gIC0gY2FsY3VsYXRlIFUgYXMgc3VtIG9mIGFsbCBVX2ksIGNhbGN1bGF0ZSBUIGFzIHN1bSBvZiBhbGwgVF9pICg1RClcbiAgICAvLyAgLSBpZiBVIGVxdWFscyBULCB0aGVuIHJldHVybiBvd24gU1NoYXJlIHdoaWNoIGlzIGJlaW5nIHJldHVybmVkIGJ5IEVjZHNhLnNpZ24oKSByaWdodCBub3cgKDVFKVxuICAgIGNvbnN0IFtwdWJsaWNVVFNoYXJlc18xLCBwdWJsaWNVVFNoYXJlc18yXSA9IFtVVDEgYXMgUHVibGljVVRTaGFyZSwgVVQyIGFzIFB1YmxpY1VUU2hhcmVdO1xuICAgIGNvbnN0IFtzaWduYXR1cmUxLCBzaWduYXR1cmUyXSA9IFtcbiAgICAgIGVjZHNhLnZlcmlmeVVUU2hhcmVzKFVUMSwgW3B1YmxpY1VUU2hhcmVzXzJdKSxcbiAgICAgIGVjZHNhLnZlcmlmeVVUU2hhcmVzKFVUMiwgW3B1YmxpY1VUU2hhcmVzXzFdKSxcbiAgICBdO1xuXG4gICAgLy8gU3RlcCA1RTogQnJvYWRjYXN0IHNfaSByZXR1cm5lZCBieSBFY2RzYS52ZXJpZnlVVFNoYXJlcygpIGFib3ZlIHRvIG90aGVyIHBhcnRpZXMuXG4gICAgLy8gICAgICAgICAgVmVyaWZ5IHRoZSBzdW0gb2Ygc19pIHNob3VsZCBiZSBhIHZhbGlkIHNpZ25hdHVyZS5cbiAgICBjb25zdCBzaWduYXR1cmUgPSBlY2RzYS5jb25zdHJ1Y3RTaWduYXR1cmUoW3NpZ25hdHVyZTEsIHNpZ25hdHVyZTJdKTtcbiAgICBlY2RzYS52ZXJpZnkobWVzc2FnZSwgc2lnbmF0dXJlKS5zaG91bGQuYmUudHJ1ZSgpO1xuICB9KTtcblxuICBpdCgnc2lnbiBwaGFzZSA1IGZhaWwgLSBtYWxpY2lvdXMgcGxheWVyIGNoZWF0cyB3aXRoIGJhZCBzIHNoYXJlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBCdWZmZXIuZnJvbSgnR0cxOCBQSEFTRSA1Jyk7XG5cbiAgICBjb25zdCBbc2lnbjEsIHNpZ24yXSA9IFtcbiAgICAgIGVjZHNhLmdlbmVyYXRlVkFQcm9vZnMobWVzc2FnZSwgZWNkc2Euc2lnbihtZXNzYWdlLCBzaWduQ29tYmluZTEub1NoYXJlLCBzaWduQ29tYmluZTIuZFNoYXJlKSksXG4gICAgICBlY2RzYS5nZW5lcmF0ZVZBUHJvb2ZzKG1lc3NhZ2UsIGVjZHNhLnNpZ24obWVzc2FnZSwgc2lnbkNvbWJpbmUyLm9TaGFyZSwgc2lnbkNvbWJpbmUxLmRTaGFyZSkpLFxuICAgIF07XG5cbiAgICBzaWduMS5SLnNob3VsZC5lcXVhbChzaWduMi5SKTtcbiAgICBzaWduMS55LnNob3VsZC5lcXVhbChzaWduMi55KTtcbiAgICBzaWduMS5tLnRvU3RyaW5nKCdoZXgnKS5zaG91bGQuZXF1YWwoc2lnbjIubS50b1N0cmluZygnaGV4JykpO1xuXG4gICAgLy8gQ2hhbmdlIHRoZSBzIHNoYXJlIG9mIHNpZ24xLCBhbmQgcmVjYWxjdWFsdGUgaXRzIFYgYWxvbmcgd2l0aCB0aGUgY29tbWl0bWVudC9wcm9vZiBieSBmb2xsb3dpbmcgcHJvdG9jb2wuXG4gICAgY29uc3QgYmFkX3MgPSBoZXhUb0JpZ0ludChzaWduMS5zKSArIEJpZ0ludCgxKTtcblxuICAgIGNvbnN0IGJhZF9WID0gRWNkc2EuY3VydmUucG9pbnRBZGQoXG4gICAgICBFY2RzYS5jdXJ2ZS5wb2ludE11bHRpcGx5KGhleFRvQmlnSW50KHNpZ24xLlIpLCBiYWRfcyksXG4gICAgICBFY2RzYS5jdXJ2ZS5iYXNlUG9pbnRNdWx0KHNpZ24xLmwpXG4gICAgKTtcblxuICAgIGNvbnN0IGNvbURlY29tX1ZfQSA9IEhhc2hDb21taXRtZW50LmNyZWF0ZUNvbW1pdG1lbnQoXG4gICAgICBCdWZmZXIuY29uY2F0KFtcbiAgICAgICAgYmlnSW50VG9CdWZmZXJCRShiYWRfViwgRWNkc2EuY3VydmUucG9pbnRCeXRlcyksXG4gICAgICAgIGJpZ0ludFRvQnVmZmVyQkUoc2lnbjEuQSwgRWNkc2EuY3VydmUucG9pbnRCeXRlcyksXG4gICAgICBdKVxuICAgICk7XG4gICAgY29uc3QgemtWUHJvb2YgPSBFY2RzYVprVlByb29mLmNyZWF0ZVprVlByb29mKFxuICAgICAgYmFkX1YsXG4gICAgICBiYWRfcyxcbiAgICAgIHNpZ24xLmwsXG4gICAgICBoZXhUb0JpZ0ludChzaWduMS5SKSxcbiAgICAgIEVjZHNhLmN1cnZlLFxuICAgICAgc2lnbjEucHJvb2ZDb250ZXh0XG4gICAgKTtcblxuICAgIHNpZ24xLnMgPSBiaWdJbnRUb0J1ZmZlckJFKGJhZF9zLCAzMikudG9TdHJpbmcoJ2hleCcpO1xuICAgIHNpZ24xLlYgPSBiYWRfVjtcbiAgICBzaWduMS5jb21EZWNvbVZBID0gY29tRGVjb21fVl9BO1xuICAgIHNpZ24xLnprVlByb29mViA9IHprVlByb29mO1xuXG4gICAgLy8gNUIgd2lsbCBwYXNzLlxuICAgIGNvbnN0IFtwdWJsaWNWQVNoYXJlc18xLCBwdWJsaWNWQVNoYXJlc18yXSA9IFtzaWduMSBhcyBQdWJsaWNWQVNoYXJlV2l0aFByb29mcywgc2lnbjIgYXMgUHVibGljVkFTaGFyZVdpdGhQcm9vZnNdO1xuICAgIGNvbnN0IFtVVDEsIFVUMl0gPSBbXG4gICAgICBlY2RzYS52ZXJpZnlWQVNoYXJlcyhzaWduMSwgW3B1YmxpY1ZBU2hhcmVzXzJdKSxcbiAgICAgIGVjZHNhLnZlcmlmeVZBU2hhcmVzKHNpZ24yLCBbcHVibGljVkFTaGFyZXNfMV0pLFxuICAgIF07XG5cbiAgICAvLyBCdXQgdmVyaWZpY2F0aW9uIGF0IGJlZ2lubmluZyBvZiA1RSB3aWxsIGZhaWwuXG4gICAgY29uc3QgW3B1YmxpY1VUU2hhcmVzXzEsIHB1YmxpY1VUU2hhcmVzXzJdID0gW1VUMSBhcyBQdWJsaWNVVFNoYXJlLCBVVDIgYXMgUHVibGljVVRTaGFyZV07XG4gICAgKCgpID0+IGVjZHNhLnZlcmlmeVVUU2hhcmVzKFVUMSwgW3B1YmxpY1VUU2hhcmVzXzJdKSkuc2hvdWxkLnRocm93KCdTdW0gb2YgYWxsIFVfaSBkb2VzIG5vdCBtYXRjaCBzdW0gb2YgYWxsIFRfaScpO1xuICAgICgoKSA9PiBlY2RzYS52ZXJpZnlVVFNoYXJlcyhVVDIsIFtwdWJsaWNVVFNoYXJlc18xXSkpLnNob3VsZC50aHJvdygnU3VtIG9mIGFsbCBVX2kgZG9lcyBub3QgbWF0Y2ggc3VtIG9mIGFsbCBUX2knKTtcbiAgfSk7XG59KTtcbiJdfQ==