"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getUserPartyGpgKey = exports.getBitGoPartyGpgKey = exports.verifyBitGoMessagesAndSignaturesRoundTwo = exports.verifyBitGoMessagesAndSignaturesRoundOne = exports.getSignatureShareRoundThree = exports.getSignatureShareRoundTwo = exports.getSignatureShareRoundOne = void 0;
const utils_1 = require("../../utils");
const sdk_lib_mpc_1 = require("@bitgo/sdk-lib-mpc");
const public_types_1 = require("@bitgo/public-types");
const assert_1 = __importDefault(require("assert"));
/**
 Helpers in this take care of all interaction with WP API's
**/
async function getSignatureShareRoundOne(round1Message, userGpgKey, partyId = 0) {
    const serializedMessages = sdk_lib_mpc_1.DklsTypes.serializeMessages({
        broadcastMessages: [round1Message],
        p2pMessages: [],
    });
    const authEncBroadcastMessage = (await sdk_lib_mpc_1.DklsComms.encryptAndAuthOutgoingMessages(serializedMessages, [], // Broadcast message so doesn't need to encrypt to BitGo's GPG key
    [getUserPartyGpgKey(userGpgKey, partyId)])).broadcastMessages[0];
    // Share type expected by Wallet Platform's API
    (0, assert_1.default)(public_types_1.MPCv2PartyFromStringOrNumber.is(authEncBroadcastMessage.from));
    const share = {
        type: 'round1Input',
        data: {
            msg1: {
                from: authEncBroadcastMessage.from,
                message: authEncBroadcastMessage.payload.message,
                signature: authEncBroadcastMessage.payload.signature,
            },
        },
    };
    const serializedShare = JSON.stringify(share);
    return {
        from: partyId === 0 ? utils_1.SignatureShareType.USER : utils_1.SignatureShareType.BACKUP,
        to: utils_1.SignatureShareType.BITGO,
        share: serializedShare,
    };
}
exports.getSignatureShareRoundOne = getSignatureShareRoundOne;
async function getSignatureShareRoundTwo(userToBitGoMessages2, userToBitGoMessages3, userGpgKey, bitgoGpgKey, partyId = 0) {
    const userToBitGoEncryptedMsg2 = await sdk_lib_mpc_1.DklsComms.encryptAndAuthOutgoingMessages(sdk_lib_mpc_1.DklsTypes.serializeMessages(userToBitGoMessages2), [getBitGoPartyGpgKey(bitgoGpgKey)], [getUserPartyGpgKey(userGpgKey, partyId)]);
    const userToBitGoEncryptedMsg3 = await sdk_lib_mpc_1.DklsComms.encryptAndAuthOutgoingMessages(sdk_lib_mpc_1.DklsTypes.serializeMessages(userToBitGoMessages3), [getBitGoPartyGpgKey(bitgoGpgKey)], [getUserPartyGpgKey(userGpgKey, partyId)]);
    (0, assert_1.default)(userToBitGoEncryptedMsg2.p2pMessages.length, 'User to BitGo messages 2 not present.');
    (0, assert_1.default)(userToBitGoEncryptedMsg3.p2pMessages.length, 'User to BitGo messages 3 not present.');
    (0, assert_1.default)(public_types_1.MPCv2PartyFromStringOrNumber.is(userToBitGoEncryptedMsg2.p2pMessages[0].from));
    (0, assert_1.default)(public_types_1.MPCv2PartyFromStringOrNumber.is(userToBitGoEncryptedMsg2.p2pMessages[0].to));
    (0, assert_1.default)(public_types_1.MPCv2PartyFromStringOrNumber.is(userToBitGoEncryptedMsg3.p2pMessages[0].from));
    (0, assert_1.default)(public_types_1.MPCv2PartyFromStringOrNumber.is(userToBitGoEncryptedMsg3.p2pMessages[0].to));
    const share = {
        type: 'round2Input',
        data: {
            msg2: {
                from: userToBitGoEncryptedMsg2.p2pMessages[0].from,
                to: userToBitGoEncryptedMsg2.p2pMessages[0].to,
                encryptedMessage: userToBitGoEncryptedMsg2.p2pMessages[0].payload.encryptedMessage,
                signature: userToBitGoEncryptedMsg2.p2pMessages[0].payload.signature,
            },
            msg3: {
                from: userToBitGoEncryptedMsg3.p2pMessages[0].from,
                to: userToBitGoEncryptedMsg3.p2pMessages[0].to,
                encryptedMessage: userToBitGoEncryptedMsg3.p2pMessages[0].payload.encryptedMessage,
                signature: userToBitGoEncryptedMsg3.p2pMessages[0].payload.signature,
            },
        },
    };
    return {
        from: partyId === 0 ? utils_1.SignatureShareType.USER : utils_1.SignatureShareType.BACKUP,
        to: utils_1.SignatureShareType.BITGO,
        share: JSON.stringify(share),
    };
}
exports.getSignatureShareRoundTwo = getSignatureShareRoundTwo;
async function getSignatureShareRoundThree(userToBitGoMessages4, userGpgKey, bitgoGpgKey, partyId = 0) {
    var _a;
    const userToBitGoEncryptedMsg4 = await sdk_lib_mpc_1.DklsComms.encryptAndAuthOutgoingMessages(sdk_lib_mpc_1.DklsTypes.serializeMessages(userToBitGoMessages4), [getBitGoPartyGpgKey(bitgoGpgKey)], [getUserPartyGpgKey(userGpgKey, partyId)]);
    (0, assert_1.default)(public_types_1.MPCv2PartyFromStringOrNumber.is(userToBitGoEncryptedMsg4.broadcastMessages[0].from));
    if (!((_a = userToBitGoEncryptedMsg4.broadcastMessages[0].signatureR) === null || _a === void 0 ? void 0 : _a.message)) {
        throw Error('signatureR should be defined');
    }
    const share = {
        type: 'round3Input',
        data: {
            msg4: {
                from: userToBitGoEncryptedMsg4.broadcastMessages[0].from,
                message: userToBitGoEncryptedMsg4.broadcastMessages[0].payload.message,
                signature: userToBitGoEncryptedMsg4.broadcastMessages[0].payload.signature,
                signatureR: userToBitGoEncryptedMsg4.broadcastMessages[0].signatureR.message,
            },
        },
    };
    return {
        from: partyId === 0 ? utils_1.SignatureShareType.USER : utils_1.SignatureShareType.BACKUP,
        to: utils_1.SignatureShareType.BITGO,
        share: JSON.stringify(share),
    };
}
exports.getSignatureShareRoundThree = getSignatureShareRoundThree;
async function verifyBitGoMessagesAndSignaturesRoundOne(parsedSignatureShare, userGpgKey, bitgoGpgKey, partyId = 0) {
    return await sdk_lib_mpc_1.DklsComms.decryptAndVerifyIncomingMessages({
        p2pMessages: [
            {
                from: parsedSignatureShare.data.msg2.from,
                to: parsedSignatureShare.data.msg2.to,
                payload: {
                    encryptedMessage: parsedSignatureShare.data.msg2.encryptedMessage,
                    signature: parsedSignatureShare.data.msg2.signature,
                },
            },
        ],
        broadcastMessages: [
            {
                from: parsedSignatureShare.data.msg1.from,
                payload: {
                    message: parsedSignatureShare.data.msg1.message,
                    signature: parsedSignatureShare.data.msg1.signature,
                },
            },
        ],
    }, [getBitGoPartyGpgKey(bitgoGpgKey)], [getUserPartyGpgKey(userGpgKey, partyId)]);
}
exports.verifyBitGoMessagesAndSignaturesRoundOne = verifyBitGoMessagesAndSignaturesRoundOne;
async function verifyBitGoMessagesAndSignaturesRoundTwo(parsedSignatureShare, userGpgKey, bitgoGpgKey, partyId = 0) {
    return await sdk_lib_mpc_1.DklsComms.decryptAndVerifyIncomingMessages({
        p2pMessages: [
            {
                from: parsedSignatureShare.data.msg3.from,
                to: parsedSignatureShare.data.msg3.to,
                payload: {
                    encryptedMessage: parsedSignatureShare.data.msg3.encryptedMessage,
                    signature: parsedSignatureShare.data.msg3.signature,
                },
            },
        ],
        broadcastMessages: [],
    }, [getBitGoPartyGpgKey(bitgoGpgKey)], [getUserPartyGpgKey(userGpgKey, partyId)]);
}
exports.verifyBitGoMessagesAndSignaturesRoundTwo = verifyBitGoMessagesAndSignaturesRoundTwo;
function getBitGoPartyGpgKey(key) {
    return {
        partyId: 2,
        gpgKey: key.armor(),
    };
}
exports.getBitGoPartyGpgKey = getBitGoPartyGpgKey;
function getUserPartyGpgKey(key, partyId = 0) {
    return {
        partyId: partyId,
        gpgKey: key.privateKey,
    };
}
exports.getUserPartyGpgKey = getUserPartyGpgKey;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWNkc2FNUEN2Mi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9iaXRnby90c3MvZWNkc2EvZWNkc2FNUEN2Mi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSx1Q0FBdUU7QUFFdkUsb0RBQTBEO0FBQzFELHNEQU82QjtBQUM3QixvREFBNEI7QUFFNUI7O0dBRUc7QUFFSSxLQUFLLFVBQVUseUJBQXlCLENBQzdDLGFBQXFELEVBQ3JELFVBQTZDLEVBQzdDLFVBQWlCLENBQUM7SUFFbEIsTUFBTSxrQkFBa0IsR0FBRyx1QkFBUyxDQUFDLGlCQUFpQixDQUFDO1FBQ3JELGlCQUFpQixFQUFFLENBQUMsYUFBYSxDQUFDO1FBQ2xDLFdBQVcsRUFBRSxFQUFFO0tBQ2hCLENBQUMsQ0FBQztJQUNILE1BQU0sdUJBQXVCLEdBQUcsQ0FDOUIsTUFBTSx1QkFBUyxDQUFDLDhCQUE4QixDQUM1QyxrQkFBa0IsRUFDbEIsRUFBRSxFQUFFLGtFQUFrRTtJQUN0RSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUMxQyxDQUNGLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkIsK0NBQStDO0lBQy9DLElBQUEsZ0JBQU0sRUFBQywyQ0FBNEIsQ0FBQyxFQUFFLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN0RSxNQUFNLEtBQUssR0FBbUM7UUFDNUMsSUFBSSxFQUFFLGFBQWE7UUFDbkIsSUFBSSxFQUFFO1lBQ0osSUFBSSxFQUFFO2dCQUNKLElBQUksRUFBRSx1QkFBdUIsQ0FBQyxJQUFJO2dCQUNsQyxPQUFPLEVBQUUsdUJBQXVCLENBQUMsT0FBTyxDQUFDLE9BQU87Z0JBQ2hELFNBQVMsRUFBRSx1QkFBdUIsQ0FBQyxPQUFPLENBQUMsU0FBUzthQUNyRDtTQUNGO0tBQ0YsQ0FBQztJQUNGLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxT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S0FBSyxFQUFFO0tBQ3BCLENBQUM7QUFDSixDQUFDO0FBTEQsa0RBS0M7QUFFRCxTQUFnQixrQkFBa0IsQ0FBQyxHQUFzQyxFQUFFLFVBQWlCLENBQUM7SUFDM0YsT0FBTztRQUNMLE9BQU8sRUFBRSxPQUFPO1FBQ2hCLE1BQU0sRUFBRSxHQUFHLENBQUMsVUFBVTtLQUN2QixDQUFDO0FBQ0osQ0FBQztBQUxELGdEQUtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2lnbmF0dXJlU2hhcmVSZWNvcmQsIFNpZ25hdHVyZVNoYXJlVHlwZSB9IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCBvcGVucGdwIGZyb20gJ29wZW5wZ3AnO1xuaW1wb3J0IHsgRGtsc0NvbW1zLCBEa2xzVHlwZXMgfSBmcm9tICdAYml0Z28vc2RrLWxpYi1tcGMnO1xuaW1wb3J0IHtcbiAgTVBDdjJTaWduYXR1cmVTaGFyZVJvdW5kMUlucHV0LFxuICBNUEN2MlNpZ25hdHVyZVNoYXJlUm91bmQxT3V0cHV0LFxuICBNUEN2MlNpZ25hdHVyZVNoYXJlUm91bmQySW5wdXQsXG4gIE1QQ3YyU2lnbmF0dXJlU2hhcmVSb3VuZDJPdXRwdXQsXG4gIE1QQ3YyU2lnbmF0dXJlU2hhcmVSb3VuZDNJbnB1dCxcbiAgTVBDdjJQYXJ0eUZyb21TdHJpbmdPck51bWJlcixcbn0gZnJvbSAnQGJpdGdvL3B1YmxpYy10eXBlcyc7XG5pbXBvcnQgYXNzZXJ0IGZyb20gJ2Fzc2VydCc7XG5cbi8qKlxuIEhlbHBlcnMgaW4gdGhpcyB0YWtlIGNhcmUgb2YgYWxsIGludGVyYWN0aW9uIHdpdGggV1AgQVBJJ3NcbioqL1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2lnbmF0dXJlU2hhcmVSb3VuZE9uZShcbiAgcm91bmQxTWVzc2FnZTogRGtsc1R5cGVzLkRlc2VyaWFsaXplZEJyb2FkY2FzdE1lc3NhZ2UsXG4gIHVzZXJHcGdLZXk6IG9wZW5wZ3AuU2VyaWFsaXplZEtleVBhaXI8c3RyaW5nPixcbiAgcGFydHlJZDogMCB8IDEgPSAwXG4pOiBQcm9taXNlPFNpZ25hdHVyZVNoYXJlUmVjb3JkPiB7XG4gIGNvbnN0IHNlcmlhbGl6ZWRNZXNzYWdlcyA9IERrbHNUeXBlcy5zZXJpYWxpemVNZXNzYWdlcyh7XG4gICAgYnJvYWRjYXN0TWVzc2FnZXM6IFtyb3VuZDFNZXNzYWdlXSxcbiAgICBwMnBNZXNzYWdlczogW10sXG4gIH0pO1xuICBjb25zdCBhdXRoRW5jQnJvYWRjYXN0TWVzc2FnZSA9IChcbiAgICBhd2FpdCBEa2xzQ29tbXMuZW5jcnlwdEFuZEF1dGhPdXRnb2luZ01lc3NhZ2VzKFxuICAgICAgc2VyaWFsaXplZE1lc3NhZ2VzLFxuICAgICAgW10sIC8vIEJyb2FkY2FzdCBtZXNzYWdlIHNvIGRvZXNuJ3QgbmVlZCB0byBlbmNyeXB0IHRvIEJpdEdvJ3MgR1BHIGtleVxuICAgICAgW2dldFVzZXJQYXJ0eUdwZ0tleSh1c2VyR3BnS2V5LCBwYXJ0eUlkKV1cbiAgICApXG4gICkuYnJvYWRjYXN0TWVzc2FnZXNbMF07XG4gIC8vIFNoYXJlIHR5cGUgZXhwZWN0ZWQgYnkgV2FsbGV0IFBsYXRmb3JtJ3MgQVBJXG4gIGFzc2VydChNUEN2MlBhcnR5RnJvbVN0cmluZ09yTnVtYmVyLmlzKGF1dGhFbmNCcm9hZGNhc3RNZXNzYWdlLmZyb20pKTtcbiAgY29uc3Qgc2hhcmU6IE1QQ3YyU2lnbmF0dXJlU2hhcmVSb3VuZDFJbnB1dCA9IHtcbiAgICB0eXBlOiAncm91bmQxSW5wdXQnLFxuICAgIGRhdGE6IHtcbiAgICAgIG1zZzE6IHtcbiAgICAgICAgZnJvbTogYXV0aEVuY0Jyb2FkY2FzdE1lc3NhZ2UuZnJvbSxcbiAgICAgICAgbWVzc2FnZTogYXV0aEVuY0Jyb2FkY2FzdE1lc3NhZ2UucGF5bG9hZC5tZXNzYWdlLFxuICAgICAgICBzaWduYXR1cmU6IGF1dGhFbmNCcm9hZGNhc3RNZXNzYWdlLnBheWxvYWQuc2lnbmF0dXJlLFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuICBjb25zdCBzZXJpYWxpemVkU2hhcmUgPSBKU09OLnN0cmluZ2lmeShzaGFyZSk7XG4gIHJldHVybiB7XG4gICAgZnJvbTogcGFydHlJZCA9PT0gMCA/IFNpZ25hdHVyZVNoYXJlVHlwZS5VU0VSIDogU2lnbmF0dXJlU2hhcmVUeXBlLkJBQ0tVUCxcbiAgICB0bzogU2lnbmF0dXJlU2hhcmVUeXBlLkJJVEdPLFxuICAgIHNoYXJlOiBzZXJpYWxpemVkU2hhcmUsXG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTaWduYXR1cmVTaGFyZVJvdW5kVHdvKFxuICB1c2VyVG9CaXRHb01lc3NhZ2VzMjogRGtsc1R5cGVzLkRlc2VyaWFsaXplZE1lc3NhZ2VzLFxuICB1c2VyVG9CaXRHb01lc3NhZ2VzMzogRGtsc1R5cGVzLkRlc2VyaWFsaXplZE1lc3NhZ2VzLFxuICB1c2VyR3BnS2V5OiBvcGVucGdwLlNlcmlhbGl6ZWRLZXlQYWlyPHN0cmluZz4sXG4gIGJpdGdvR3BnS2V5OiBvcGVucGdwLktleSxcbiAgcGFydHlJZDogMCB8IDEgPSAwXG4pOiBQcm9taXNlPFNpZ25hdHVyZVNoYXJlUmVjb3JkPiB7XG4gIGNvbnN0IHVzZXJUb0JpdEdvRW5jcnlwdGVkTXNnMiA9IGF3YWl0IERrbHNDb21tcy5lbmNyeXB0QW5kQXV0aE91dGdvaW5nTWVzc2FnZXMoXG4gICAgRGtsc1R5cGVzLnNlcmlhbGl6ZU1lc3NhZ2VzKHVzZXJUb0JpdEdvTWVzc2FnZXMyKSxcbiAgICBbZ2V0Qml0R29QYXJ0eUdwZ0tleShiaXRnb0dwZ0tleSldLFxuICAgIFtnZXRVc2VyUGFydHlHcGdLZXkodXNlckdwZ0tleSwgcGFydHlJZCldXG4gICk7XG5cbiAgY29uc3QgdXNlclRvQml0R29FbmNyeXB0ZWRNc2czID0gYXdhaXQgRGtsc0NvbW1zLmVuY3J5cHRBbmRBdXRoT3V0Z29pbmdNZXNzYWdlcyhcbiAgICBEa2xzVHlwZXMuc2VyaWFsaXplTWVzc2FnZXModXNlclRvQml0R29NZXNzYWdlczMpLFxuICAgIFtnZXRCaXRHb1BhcnR5R3BnS2V5KGJpdGdvR3BnS2V5KV0sXG4gICAgW2dldFVzZXJQYXJ0eUdwZ0tleSh1c2VyR3BnS2V5LCBwYXJ0eUlkKV1cbiAgKTtcbiAgYXNzZXJ0KHVzZXJUb0JpdEdvRW5jcnlwdGVkTXNnMi5wMnBNZXNzYWdlcy5sZW5ndGgsICdVc2VyIHRvIEJpdEdvIG1lc3NhZ2VzIDIgbm90IHByZXNlbnQuJyk7XG4gIGFzc2VydCh1c2VyVG9CaXRHb0VuY3J5cHRlZE1zZzMucDJwTWVzc2FnZXMubGVuZ3RoLCAnVXNlciB0byBCaXRHbyBtZXNzYWdlcyAzIG5vdCBwcmVzZW50LicpO1xuICBhc3NlcnQoTVBDdjJQYXJ0eUZyb21TdHJpbmdPck51bWJlci5pcyh1c2VyVG9CaXRHb0VuY3J5cHRlZE1zZzIucDJwTWVzc2FnZXNbMF0uZnJvbSkpO1xuICBhc3NlcnQoTVBDdjJQYXJ0eUZyb21TdHJpbmdPck51bWJlci5pcyh1c2VyVG9CaXRHb0VuY3J5cHRlZE1zZzIucDJwTWVzc2FnZXNbMF0udG8pKTtcbiAgYXNzZXJ0KE1QQ3YyUGFydHlGcm9tU3RyaW5nT3JOdW1iZXIuaXModXNlclRvQml0R29FbmNyeXB0ZWRNc2czLnAycE1lc3NhZ2VzWzBdLmZyb20pKTtcbiAgYXNzZXJ0KE1QQ3YyUGFydHlGcm9tU3RyaW5nT3JOdW1iZXIuaXModXNlclRvQml0R29FbmNyeXB0ZWRNc2czLnAycE1lc3NhZ2VzWzBdLnRvKSk7XG4gIGNvbnN0IHNoYXJlOiBNUEN2MlNpZ25hdHVyZVNoYXJlUm91bmQySW5wdXQgPSB7XG4gICAgdHlwZTogJ3JvdW5kMklucHV0JyxcbiAgICBkYXRhOiB7XG4gICAgICBtc2cyOiB7XG4gICAgICAgIGZyb206IHVzZXJUb0JpdEdvRW5jcnlwdGVkTXNnMi5wMnBNZXNzYWdlc1swXS5mcm9tLFxuICAgICAgICB0bzogdXNlclRvQml0R29FbmNyeXB0ZWRNc2cyLnAycE1lc3NhZ2VzWzBdLnRvLFxuICAgICAgICBlbmNyeXB0ZWRNZXNzYWdlOiB1c2VyVG9CaXRHb0VuY3J5cHRlZE1zZzIucDJwTWVzc2FnZXNbMF0ucGF5bG9hZC5lbmNyeXB0ZWRNZXNzYWdlLFxuICAgICAgICBzaWduYXR1cmU6IHVzZXJUb0JpdEdvRW5jcnlwdGVkTXNnMi5wMnBNZXNzYWdlc1swXS5wYXlsb2FkLnNpZ25hdHVyZSxcbiAgICAgIH0sXG4gICAgICBtc2czOiB7XG4gICAgICAgIGZyb206IHVzZXJUb0JpdEdvRW5jcnlwdGVkTXNnMy5wMnBNZXNzYWdlc1swXS5mcm9tLFxuICAgICAgICB0bzogdXNlclRvQml0R29FbmNyeXB0ZWRNc2czLnAycE1lc3NhZ2VzWzBdLnRvLFxuICAgICAgICBlbmNyeXB0ZWRNZXNzYWdlOiB1c2VyVG9CaXRHb0VuY3J5cHRlZE1zZzMucDJwTWVzc2FnZXNbMF0ucGF5bG9hZC5lbmNyeXB0ZWRNZXNzYWdlLFxuICAgICAgICBzaWduYXR1cmU6IHVzZXJUb0JpdEdvRW5jcnlwdGVkTXNnMy5wMnBNZXNzYWdlc1swXS5wYXlsb2FkLnNpZ25hdHVyZSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBmcm9tOiBwYXJ0eUlkID09PSAwID8gU2lnbmF0dXJlU2hhcmVUeXBlLlVTRVIgOiBTaWduYXR1cmVTaGFyZVR5cGUuQkFDS1VQLFxuICAgIHRvOiBTaWduYXR1cmVTaGFyZVR5cGUuQklUR08sXG4gICAgc2hhcmU6IEpTT04uc3RyaW5naWZ5KHNoYXJlKSxcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNpZ25hdHVyZVNoYXJlUm91bmRUaHJlZShcbiAgdXNlclRvQml0R29NZXNzYWdlczQ6IERrbHNUeXBlcy5EZXNlcmlhbGl6ZWRNZXNzYWdlcyxcbiAgdXNlckdwZ0tleTogb3BlbnBncC5TZXJpYWxpemVkS2V5UGFpcjxzdHJpbmc+LFxuICBiaXRnb0dwZ0tleTogb3BlbnBncC5LZXksXG4gIHBhcnR5SWQ6IDAgfCAxID0gMFxuKTogUHJvbWlzZTxTaWduYXR1cmVTaGFyZVJlY29yZD4ge1xuICBjb25zdCB1c2VyVG9CaXRHb0VuY3J5cHRlZE1zZzQgPSBhd2FpdCBEa2xzQ29tbXMuZW5jcnlwdEFuZEF1dGhPdXRnb2luZ01lc3NhZ2VzKFxuICAgIERrbHNUeXBlcy5zZXJpYWxpemVNZXNzYWdlcyh1c2VyVG9CaXRHb01lc3NhZ2VzNCksXG4gICAgW2dldEJpdEdvUGFydHlHcGdLZXkoYml0Z29HcGdLZXkpXSxcbiAgICBbZ2V0VXNlclBhcnR5R3BnS2V5KHVzZXJHcGdLZXksIHBhcnR5SWQpXVxuICApO1xuICBhc3NlcnQoTVBDdjJQYXJ0eUZyb21TdHJpbmdPck51bWJlci5pcyh1c2VyVG9CaXRHb0VuY3J5cHRlZE1zZzQuYnJvYWRjYXN0TWVzc2FnZXNbMF0uZnJvbSkpO1xuICBpZiAoIXVzZXJUb0JpdEdvRW5jcnlwdGVkTXNnNC5icm9hZGNhc3RNZXNzYWdlc1swXS5zaWduYXR1cmVSPy5tZXNzYWdlKSB7XG4gICAgdGhyb3cgRXJyb3IoJ3NpZ25hdHVyZVIgc2hvdWxkIGJlIGRlZmluZWQnKTtcbiAgfVxuICBjb25zdCBzaGFyZTogTVBDdjJTaWduYXR1cmVTaGFyZVJvdW5kM0lucHV0ID0ge1xuICAgIHR5cGU6ICdyb3VuZDNJbnB1dCcsXG4gICAgZGF0YToge1xuICAgICAgbXNnNDoge1xuICAgICAgICBmcm9tOiB1c2VyVG9CaXRHb0VuY3J5cHRlZE1zZzQuYnJvYWRjYXN0TWVzc2FnZXNbMF0uZnJvbSxcbiAgICAgICAgbWVzc2FnZTogdXNlclRvQml0R29FbmNyeXB0ZWRNc2c0LmJyb2FkY2FzdE1lc3NhZ2VzWzBdLnBheWxvYWQubWVzc2FnZSxcbiAgICAgICAgc2lnbmF0dXJlOiB1c2VyVG9CaXRHb0VuY3J5cHRlZE1zZzQuYnJvYWRjYXN0TWVzc2FnZXNbMF0ucGF5bG9hZC5zaWduYXR1cmUsXG4gICAgICAgIHNpZ25hdHVyZVI6IHVzZXJUb0JpdEdvRW5jcnlwdGVkTXNnNC5icm9hZGNhc3RNZXNzYWdlc1swXS5zaWduYXR1cmVSLm1lc3NhZ2UsXG4gICAgICB9LFxuICAgIH0sXG4gIH07XG4gIHJldHVybiB7XG4gICAgZnJvbTogcGFydHlJZCA9PT0gMCA/IFNpZ25hdHVyZVNoYXJlVHlwZS5VU0VSIDogU2lnbmF0dXJlU2hhcmVUeXBlLkJBQ0tVUCxcbiAgICB0bzogU2lnbmF0dXJlU2hhcmVUeXBlLkJJVEdPLFxuICAgIHNoYXJlOiBKU09OLnN0cmluZ2lmeShzaGFyZSksXG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlCaXRHb01lc3NhZ2VzQW5kU2lnbmF0dXJlc1JvdW5kT25lKFxuICBwYXJzZWRTaWduYXR1cmVTaGFyZTogTVBDdjJTaWduYXR1cmVTaGFyZVJvdW5kMU91dHB1dCxcbiAgdXNlckdwZ0tleTogb3BlbnBncC5TZXJpYWxpemVkS2V5UGFpcjxzdHJpbmc+LFxuICBiaXRnb0dwZ0tleTogb3BlbnBncC5LZXksXG4gIHBhcnR5SWQ6IDAgfCAxID0gMFxuKTogUHJvbWlzZTxEa2xzVHlwZXMuU2VyaWFsaXplZE1lc3NhZ2VzPiB7XG4gIHJldHVybiBhd2FpdCBEa2xzQ29tbXMuZGVjcnlwdEFuZFZlcmlmeUluY29taW5nTWVzc2FnZXMoXG4gICAge1xuICAgICAgcDJwTWVzc2FnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGZyb206IHBhcnNlZFNpZ25hdHVyZVNoYXJlLmRhdGEubXNnMi5mcm9tLFxuICAgICAgICAgIHRvOiBwYXJzZWRTaWduYXR1cmVTaGFyZS5kYXRhLm1zZzIudG8sXG4gICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgZW5jcnlwdGVkTWVzc2FnZTogcGFyc2VkU2lnbmF0dXJlU2hhcmUuZGF0YS5tc2cyLmVuY3J5cHRlZE1lc3NhZ2UsXG4gICAgICAgICAgICBzaWduYXR1cmU6IHBhcnNlZFNpZ25hdHVyZVNoYXJlLmRhdGEubXNnMi5zaWduYXR1cmUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBicm9hZGNhc3RNZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgZnJvbTogcGFyc2VkU2lnbmF0dXJlU2hhcmUuZGF0YS5tc2cxLmZyb20sXG4gICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgbWVzc2FnZTogcGFyc2VkU2lnbmF0dXJlU2hhcmUuZGF0YS5tc2cxLm1lc3NhZ2UsXG4gICAgICAgICAgICBzaWduYXR1cmU6IHBhcnNlZFNpZ25hdHVyZVNoYXJlLmRhdGEubXNnMS5zaWduYXR1cmUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSxcbiAgICBbZ2V0Qml0R29QYXJ0eUdwZ0tleShiaXRnb0dwZ0tleSldLFxuICAgIFtnZXRVc2VyUGFydHlHcGdLZXkodXNlckdwZ0tleSwgcGFydHlJZCldXG4gICk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlCaXRHb01lc3NhZ2VzQW5kU2lnbmF0dXJlc1JvdW5kVHdvKFxuICBwYXJzZWRTaWduYXR1cmVTaGFyZTogTVBDdjJTaWduYXR1cmVTaGFyZVJvdW5kMk91dHB1dCxcbiAgdXNlckdwZ0tleTogb3BlbnBncC5TZXJpYWxpemVkS2V5UGFpcjxzdHJpbmc+LFxuICBiaXRnb0dwZ0tleTogb3BlbnBncC5LZXksXG4gIHBhcnR5SWQ6IDAgfCAxID0gMFxuKTogUHJvbWlzZTxEa2xzVHlwZXMuU2VyaWFsaXplZE1lc3NhZ2VzPiB7XG4gIHJldHVybiBhd2FpdCBEa2xzQ29tbXMuZGVjcnlwdEFuZFZlcmlmeUluY29taW5nTWVzc2FnZXMoXG4gICAge1xuICAgICAgcDJwTWVzc2FnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGZyb206IHBhcnNlZFNpZ25hdHVyZVNoYXJlLmRhdGEubXNnMy5mcm9tLFxuICAgICAgICAgIHRvOiBwYXJzZWRTaWduYXR1cmVTaGFyZS5kYXRhLm1zZzMudG8sXG4gICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgZW5jcnlwdGVkTWVzc2FnZTogcGFyc2VkU2lnbmF0dXJlU2hhcmUuZGF0YS5tc2czLmVuY3J5cHRlZE1lc3NhZ2UsXG4gICAgICAgICAgICBzaWduYXR1cmU6IHBhcnNlZFNpZ25hdHVyZVNoYXJlLmRhdGEubXNnMy5zaWduYXR1cmUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBicm9hZGNhc3RNZXNzYWdlczogW10sXG4gICAgfSxcbiAgICBbZ2V0Qml0R29QYXJ0eUdwZ0tleShiaXRnb0dwZ0tleSldLFxuICAgIFtnZXRVc2VyUGFydHlHcGdLZXkodXNlckdwZ0tleSwgcGFydHlJZCldXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRCaXRHb1BhcnR5R3BnS2V5KGtleTogb3BlbnBncC5LZXkpOiBEa2xzVHlwZXMuUGFydHlHcGdLZXkge1xuICByZXR1cm4ge1xuICAgIHBhcnR5SWQ6IDIsXG4gICAgZ3BnS2V5OiBrZXkuYXJtb3IoKSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFVzZXJQYXJ0eUdwZ0tleShrZXk6IG9wZW5wZ3AuU2VyaWFsaXplZEtleVBhaXI8c3RyaW5nPiwgcGFydHlJZDogMCB8IDEgPSAwKTogRGtsc1R5cGVzLlBhcnR5R3BnS2V5IHtcbiAgcmV0dXJuIHtcbiAgICBwYXJ0eUlkOiBwYXJ0eUlkLFxuICAgIGdwZ0tleToga2V5LnByaXZhdGVLZXksXG4gIH07XG59XG4iXX0=